"use strict";(self["webpackChunkaw_webui"]=self["webpackChunkaw_webui"]||[]).push([[8500],{77848:(t,e,r)=>{r.r(e),r.d(e,{default:()=>C});var n=function(){var t=this,e=t._self._c;return e("div",[e("h2",[t._v("Buckets")]),e("b-alert",{attrs:{show:""}},[t._v("Are you looking to collect more data? Check out "),e("a",{attrs:{href:"https://activitywatch.readthedocs.io/en/latest/watchers.html"}},[t._v("the docs")]),t._v(" for more watchers.")]),t._l(t.bucketsStore.bucketsByDevice,(function(r){return e("b-card",{key:r.hostname||r.device_id,staticClass:"mb-3"},[e("div",{staticClass:"mb-3"},[e("div",{staticClass:"d-flex"},[e("div",["unknown"===r.hostname?e("icon",{attrs:{name:"question"}}):e("icon",{attrs:{name:"desktop"}}),t._v(" ")],1),e("div",[e("b",[t._v(t._s(r.hostname))]),t.serverStore.info.hostname==r.hostname?e("span",{staticClass:"small ml-2"},[t._v("(the current device)")]):t._e(),e("div",{staticClass:"small"},[r.hostname!==r.device_id?e("div",{staticStyle:{color:"#666"}},[t._v("ID: "+t._s(r.id))]):t._e(),e("div",[t._v("Last updated: "),e("time",{style:{color:t.isRecent(r.last_updated)?"green":"inherit"},attrs:{datetime:r.last_updated,title:r.last_updated}},[t._v(t._s(t._f("friendlytime")(r.last_updated)))])]),e("div",[t._v("First seen: "),e("time",{attrs:{datetime:r.first_seen,title:r.first_seen}},[t._v(t._s(t._f("friendlytime")(r.first_seen)))])])])])])]),e("b-row",[e("b-col",[e("b-table",{staticClass:"mb-0",attrs:{small:"",hover:"",items:r.buckets,fields:t.fields,responsive:"md"},scopedSlots:t._u([{key:"cell(last_updated)",fn:function(r){return[r.item.last_updated?e("small",{style:{color:t.isRecent(r.item.last_updated)?"green":"inherit"}},[t._v(t._s(t._f("friendlytime")(r.item.last_updated)))]):t._e()]}},{key:"cell(actions)",fn:function(r){return[e("b-button-toolbar",{staticClass:"float-right"},[e("b-button-group",{staticClass:"mx-1",attrs:{size:"sm"}},[e("b-button",{attrs:{variant:"primary",to:"/buckets/"+r.item.id}},[e("icon",{staticClass:"d-none d-md-inline-block",attrs:{name:"folder-open"}}),t._v("Open")],1),e("b-dropdown",{attrs:{variant:"outline-secondary",size:"sm",text:"More"}},[e("b-dropdown-item",{attrs:{href:t.$aw.baseURL+"/api/0/buckets/"+r.item.id+"/export",download:"aw-bucket-export-"+r.item.id+".json",title:"Export bucket to JSON",variant:"secondary"}},[e("icon",{attrs:{name:"download"}}),t._v("Export bucket as JSON")],1),e("b-dropdown-item",{attrs:{title:"Export events to CSV",variant:"secondary"},on:{click:function(e){return t.export_csv(r.item.id)}}},[e("icon",{attrs:{name:"download"}}),t._v("Export events as CSV")],1),e("b-dropdown-divider"),e("b-dropdown-item-button",{attrs:{title:"Delete this bucket permanently",variant:"danger"},on:{click:function(e){return t.openDeleteBucketModal(r.item.id)}}},[e("icon",{attrs:{name:"trash"}}),t._v(" Delete bucket")],1)],1)],1)],1)]}}],null,!0)})],1)],1),t.runChecks(r).length>0?e("hr",{staticClass:"mt-1"}):t._e(),t._l(t.runChecks(r),(function(r){return e("div",{staticClass:"small text-muted",staticStyle:{color:"#333"}},[e("icon",{attrs:{name:"exclamation-triangle"}}),t._v("  "+t._s(r))],1)}))],2)})),e("b-modal",{attrs:{id:"delete-modal",title:"Danger!",centered:"","hide-footer":""}},[t._v('Are you sure you want to delete bucket "'+t._s(t.delete_bucket_selected)+'"?'),e("br"),e("br"),e("b",[t._v("This is permanent and cannot be undone!")]),e("hr"),e("div",{staticClass:"float-right"},[e("b-button",{staticClass:"mx-2",on:{click:function(e){return t.$root.$emit("bv::hide::modal","delete-modal")}}},[t._v("Cancel")]),e("b-button",{attrs:{variant:"danger"},on:{click:function(e){return t.deleteBucket(t.delete_bucket_selected)}}},[t._v("Confirm")])],1)]),e("h3",[t._v("Import and export buckets")]),e("b-card-group",{staticClass:"deck"},[e("b-card",{attrs:{header:"Import buckets"}},[t.import_error?e("b-alert",{attrs:{show:"",variant:"danger",dismissable:""}},[t._v(t._s(t.import_error))]):t._e(),e("b-form-file",{attrs:{placeholder:"Choose or drop a file here...","drop-placeholder":"Drop file here..."},model:{value:t.import_file,callback:function(e){t.import_file=e},expression:"import_file"}}),t.import_file?e("div",{staticClass:"spinner-border",attrs:{role:"status"}}):t._e(),e("span",[t._v("A valid file to import is a JSON file from either an export of a single bucket or an export from multiple buckets. If there are buckets with the same name the import will fail.")])],1),e("b-card",{attrs:{header:"Export buckets"}},[e("b-button",{attrs:{href:t.$aw.baseURL+"/api/0/export",download:"aw-bucket-export.json",title:"Export bucket to JSON",variant:"outline-secondary"}},[e("icon",{attrs:{name:"download"}}),t._v("Export all buckets as JSON")],1)],1)],1),e("hr"),e("aw-devonly",{attrs:{reason:"This section is still under development"}},[e("h2",{staticClass:"p-2"},[t._v("Tools")]),e("hr"),e("aw-bucket-validate",{staticClass:"p-2"}),e("hr"),e("aw-bucket-merge",{staticClass:"p-2"})],1)],2)},a=[],s=r(51055),i=r(27981),o=r(35161),c=r.n(o),l=r(63105),d=r.n(l),u=r(18446),h=r.n(u),m=(r(41539),r(78783),r(33948),r(47941),r(92222),r(21249),r(38559),r(60285),r(41637),r(46229),r(17330),r(62062),r(28733),r(83710),r(96886),r(14792));m["default"].register({download:{width:512,height:512,paths:[{d:"M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1l-152.1 152.2c-7.5 7.5-19.8 7.5-27.3 0l-152.3-152.2c-12.6-12.6-3.7-34.1 14.1-34.1h87.8v-168c0-13.3 10.7-24 24-24zM512 376v112c0 13.3-10.7 24-24 24h-464c-13.3 0-24-10.7-24-24v-112c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49h146.7c13.3 0 24 10.7 24 24zM388 464c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zM452 464c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"}]}}),m["default"].register({"folder-open":{width:576,height:512,paths:[{d:"M572.7 292.1l-72.4 124.2c-10.2 17.5-35 31.8-55.3 31.8h0-400c-18.5 0-30.1-20.1-20.7-36.1l72.4-124.2c10.2-17.5 35-31.8 55.3-31.8v0h400c18.5 0 30.1 20.1 20.7 36.1zM152 224c-34 0-65.8 18.3-82.9 47.6l-69.1 118.4v-278c0-26.5 21.5-48 48-48h160l64 64h160c26.5 0 48 21.5 48 48v48h-328z"}]}});r(44410),r(77960);m["default"].register({question:{width:384,height:512,paths:[{d:"M202 0c84.9 0 175.5 66.3 175.5 153.6 0 116-125.3 117.8-125.3 160.6v5.8c0 13.3-10.7 24-24 24h-72.5c-13.3 0-24-10.7-24-24v-9.8c0-61.8 46.9-86.5 82.3-106.4 30.4-17 49-28.6 49-51.2 0-29.8-38.1-49.6-68.8-49.6-39.1 0-57.7 18.1-82.8 49.4-8.1 10.2-22.9 12-33.3 4.1l-43.1-32.7c-10.3-7.8-12.5-22.3-5.2-32.9 40.6-58.3 92.3-91 172.1-91zM192 373.5c38.2 0 69.3 31.1 69.3 69.3 0 38.2-31.1 69.3-69.3 69.3s-69.3-31.1-69.3-69.3c0-38.2 31.1-69.3 69.3-69.3z"}]}});r(39886);var p=r(57460),v=r.n(p),f=r(30381),b=r.n(f),_=r(32391),k=r(85711);const w={name:"Buckets",components:{"aw-bucket-merge":function(){return r.e(5154).then(r.bind(r,85154))},"aw-bucket-validate":function(){return r.e(677).then(r.bind(r,677))}},data:function(){return{moment:b(),bucketsStore:(0,k.U)(),serverStore:(0,_.t)(),import_file:null,import_error:null,delete_bucket_selected:null,fields:[{key:"id",label:"Bucket ID",sortable:!0},{key:"hostname",sortable:!0},{key:"last_updated",label:"Updated",sortable:!0},{key:"actions",label:""}]}},watch:{import_file:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(e,r){return(0,s.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(null==this.import_file){t.next=16;break}return console.log("Importing file"),t.prev=2,t.next=5,this.importBuckets(this.import_file);case 5:console.log("Import successful"),this.import_error=null,t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](2),console.log("Import failed"),this.import_error="Import failed, see aw-server logs for more info";case 13:return t.next=15,this.bucketsStore.loadBuckets();case 15:this.import_file=null;case 16:case"end":return t.stop()}}),t,this,[[2,9]])})));function e(e,r){return t.apply(this,arguments)}return e}()},mounted:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(){return(0,s.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.bucketsStore.loadBuckets();case 2:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),methods:{isRecent:function(t){return b()().diff(t)/1e3<120},runChecks:function(t){var e=[{msg:function(){return"Device known by several hostnames: ".concat(t.hostnames)},failed:function(){return t.hostnames.length>1}},{msg:function(){return"Device known by several IDs: ".concat(t.device_ids)},failed:function(){return t.device_ids.length>1}},{msg:function(){return"Device is a special device, unattributed to a hostname, or not assigned a device ID."},failed:function(){return h()(t.hostnames,["unknown"])}}],r=d()(e,(function(t){return t.failed()}));return c()(r,(function(t){return t.msg()}))},openDeleteBucketModal:function(t){this.delete_bucket_selected=t,this.$root.$emit("bv::show::modal","delete-modal")},deleteBucket:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(e){return(0,s.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.bucketsStore.deleteBucket({bucketId:e});case 2:this.$root.$emit("bv::hide::modal","delete-modal");case 3:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),importBuckets:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(e){var r,n;return(0,s.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=new FormData,r.append("buckets.json",e),n={"Content-Type":"multipart/form-data"},t.abrupt("return",this.$aw.req.post("/0/import",r,{headers:n}));case 4:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),export_csv:function(t){var e=this;return(0,i.Z)((0,s.Z)().mark((function r(){var n,a,i,o,c,l,d,u,h;return(0,s.Z)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,e.bucketsStore.getBucketWithEvents({id:t});case 2:n=r.sent,a=n.events,i=Object.keys(a[0].data),o=["timestamp","duration"].concat(i),c=a.map((function(t){return Object.assign({timestamp:t.timestamp,duration:t.duration},Object.fromEntries(i.map((function(e){return[e,t.data[e]]}))))})),l=v().unparse(c,{columns:o,header:!0}),d=new Blob([l],{type:"text/csv"}),u=URL.createObjectURL(d),h=document.createElement("a"),h.href=u,h.download="aw-events-export-".concat(t,"-").concat((new Date).toISOString().substring(0,10),".csv"),document.body.appendChild(h),h.click(),document.body.removeChild(h);case 16:case"end":return r.stop()}}),r)})))()}}},g=w;var x=r(1001),y=(0,x.Z)(g,n,a,!1,null,"6af37d98",null);const C=y.exports},44410:(t,e,r)=>{var n=r(14792);n["default"].register({desktop:{width:576,height:512,paths:[{d:"M528 0c26.5 0 48 21.5 48 48v320c0 26.5-21.5 48-48 48h-192l16 48h72c13.3 0 24 10.7 24 24s-10.7 24-24 24h-272c-13.3 0-24-10.7-24-24s10.7-24 24-24h72l16-48h-192c-26.5 0-48-21.5-48-48v-320c0-26.5 21.5-48 48-48h480zM512 352v-288h-448v288h448z"}]}})},39886:(t,e,r)=>{var n=r(14792);n["default"].register({"exclamation-triangle":{width:576,height:512,paths:[{d:"M569.5 440c18.5 32-4.7 72-41.6 72h-479.9c-36.9 0-60-40.1-41.6-72l239.9-416c18.5-32 64.7-32 83.2 0zM288 354c-25.4 0-46 20.6-46 46s20.6 46 46 46 46-20.6 46-46-20.6-46-46-46zM244.3 188.7l7.4 136c0.3 6.4 5.6 11.3 12 11.3h48.5c6.4 0 11.6-5 12-11.3l7.4-136c0.4-6.9-5.1-12.7-12-12.7h-63.4c-6.9 0-12.4 5.8-12 12.7z"}]}})},77960:(t,e,r)=>{var n=r(14792);n["default"].register({mobile:{width:320,height:512,paths:[{d:"M272 0c26.5 0 48 21.5 48 48v416c0 26.5-21.5 48-48 48h-224c-26.5 0-48-21.5-48-48v-416c0-26.5 21.5-48 48-48h224zM160 480c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32z"}]}})},96886:(t,e,r)=>{var n=r(14792);n["default"].register({trash:{width:448,height:512,paths:[{d:"M432 32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16h-416c-8.8 0-16-7.2-16-16v-32c0-8.8 7.2-16 16-16h120l9.4-18.7c3.6-7.3 13.1-13.3 21.3-13.3h0.1 114.3 0c8.2 0 17.8 6 21.5 13.3l9.4 18.7h120zM53.2 467l-21.2-339h384l-21.2 339c-1.6 24.8-23 45-47.9 45h-245.8c-24.9 0-46.3-20.2-47.9-45z"}]}})}}]);
//# sourceMappingURL=8500.53e806a5.js.map