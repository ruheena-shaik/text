(self["webpackChunkaw_webui"]=self["webpackChunkaw_webui"]||[]).push([[370],{21022:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>z});r(69600);var n=function(){var e=this,t=e._self._c;return t("div",[t("h1",[e._v("Categorization helper")]),t("div",[t("p",[e._v("This tool will help you create categories from your uncategorized time.")]),t("p",[e._v("It works by fetching all uncategorized time for a recent timeperiod, and then finds the most common words (by time, not count) each of which may then either be ignored (if too broad/irrelevant), or used to create a new (sub)category, or to append the word to a pre-existing category rule. Words with less than 60s of time will not be shown.")]),t("p",[e._v("When you're done, you can inspect the categories in the "),t("router-link",{attrs:{to:{path:"/settings"}}},[e._v("Settings")]),e._v(" page.")],1)]),t("div",{staticClass:"d-flex"},[t("div",{staticClass:"flex-grow-1"},[e._m(0),t("div",[t("small",[e._v("Hostname: "+e._s(e.queryOptions.hostname))])]),t("div",[t("small",[e._v("Range: "+e._s(e.queryOptions.start)+" - "+e._s(e.queryOptions.stop))])])]),t("div",{staticClass:"flex-grow-0"},[t("b-button",{attrs:{variant:"outline-dark",size:"sm"},on:{click:function(t){e.show_options=!e.show_options}}},[e.show_options?t("span",[e._v("Hide options")]):t("span",[e._v("Show options")])])],1)]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.show_options,expression:"show_options"}]},[t("hr"),t("h4",[e._v("Options")]),t("aw-query-options",{model:{value:e.queryOptions,callback:function(t){e.queryOptions=t},expression:"queryOptions"}})],1),t("hr"),t("h5",[e._v('Common words in "'+e._s(e.category.join(" > "))+'" events')]),e.loading?t("div",[e._v("Loading...")]):t("div",[0==e.words_by_duration.length?t("div",[e._v("No words with significant duration. You're good to go!")]):t("div",e._l(e.words_by_duration,(function(r){return t("div",{staticClass:"row category-builder-word"},[t("div",{staticClass:"col hover-highlight"},[t("div",{staticClass:"d-flex flex-row py-2"},[t("div",{staticClass:"flex-grow-1"},[e._v(e._s(r.word)+" ("+e._s(Math.round(r.duration))+"s)")]),t("div",{staticClass:"flex-grow-0"},[t("b-button",{staticClass:"mr-1",attrs:{size:"sm",variant:"success"},on:{click:function(t){return e.createRule(r.word)}}},[e._v("New rule")]),t("b-button",{staticClass:"mr-1",attrs:{size:"sm",variant:"warning"},on:{click:function(t){return e.appendRule(r.word)}}},[e._v("Append rule")]),t("b-button",{staticClass:"mr-1",attrs:{size:"sm"},on:{click:function(t){return e.ignoreWord(r.word)}}},[e._v("Ignore")]),t("b-button",{attrs:{size:"sm",variant:"outline-dark"},on:{click:function(t){return e.showEvents(r)}}},[e.showing_events[0]!=r?t("span",[e._v("Show events")]):t("span",[e._v("Hide events")])])],1)]),e.showing_events&&e.showing_events[0]==r?t("div",[t("table",{staticClass:"table table-sm table-striped"},[e._m(1,!0),e._l(e.showing_events[1],(function(r){return t("tr",[t("td",[e._v(e._s(r.data.title))]),t("td",{staticClass:"text-right"},[e._v(e._s(Math.round(r.duration))+"s")])])}))],2),t("hr")]):e._e()])])})),0)]),null!==e.create.categoryId?t("div",[t("CategoryEditModal",{attrs:{categoryId:e.create.categoryId},on:{ok:function(t){return e.createRuleOk()},hidden:function(t){return e.createRuleCancel()}}})],1):e._e(),t("b-modal",{attrs:{id:"appendRule",title:"Append rule","ok-disabled":!e.valid},on:{ok:e.handleOk}},[t("b-form",{ref:"form",on:{submit:function(t){return t.stopPropagation(),t.preventDefault(),e.handleSubmit.apply(null,arguments)}}},[t("b-form-group",{attrs:{label:"Rule","label-for":"append-category","invalid-feedback":"Category is required",state:e.validCategory,required:""}},[t("b-form-select",{attrs:{id:"append-category"},model:{value:e.append.category,callback:function(t){e.$set(e.append,"category",t)},expression:"append.category"}},e._l(e.allCategoriesSelect,(function(r){return t("b-form-select-option",{key:r.id,attrs:{value:r.value}},[e._v(e._s(r.text))])})),1)],1),t("b-form-group",{attrs:{label:"Word"}},[t("b-form-input",{model:{value:e.append.word,callback:function(t){e.$set(e.append,"word",t)},expression:"append.word"}}),t("small",[e.validPattern?t("div",{staticStyle:{color:"green"}},[e._v("Valid")]):t("div",{staticStyle:{color:"red"}},[e._v("Invalid pattern")]),e.validPattern&&e.broad_pattern?t("div",{staticStyle:{color:"orange"}},[e._v("Pattern too broad")]):e._e()])],1)],1)],1)],1)},o=[function(){var e=this,t=e._self._c;return t("div",[t("b",[e._v("Options")])])},function(){var e=this,t=e._self._c;return t("tr",[t("th",[e._v("Title")]),t("th",{staticClass:"text-right"},[e._v("Duration")])])}],a=r(59771),s=r(51055),i=r(27981),c=r(50257),d=r(97911),u=r(35161),l=r.n(u),p=r(6162),v=r.n(p),h=r(3522),g=r.n(h),f=r(63105),w=r.n(f),_=(r(41539),r(33948),r(57327),r(2707),r(26699),r(32023),r(83710),r(51532),r(78783),r(74916),r(23123),r(57658),r(38862),r(30381)),y=r.n(_),b=r(69876),m=r(86845),k=r(85711),x=r(72260),C=r(47840),O=r(48154),Z=r(44109);const S={name:"aw-category-builder",components:{CategoryEditModal:O.Z},props:{},data:function(){return{loading:!0,categoryStore:(0,m.v)(),show_options:!1,queryOptions:{start:y()().subtract(1,"day"),stop:y()().add(1,"day")},category:["Uncategorized"],words:{},showing_events:[],ignored_words:[],append:{word:"",category:[]},create:{word:"",categoryId:null}}},computed:(0,d.Z)((0,d.Z)({},(0,b.rn)(m.v,["allCategoriesSelect"])),{},{words_by_duration:function(){var e=this,t=(0,c.Z)(this.words.values());return t.sort((function(e,t){return t.duration-e.duration})).filter((function(e){return e.duration>60})).filter((function(t){return!e.ignored_words.includes(t.word)}))},valid:function(){return this.validPattern&&this.validCategory},validPattern:function(){return(0,Z.I)(this.append.word)},validCategory:function(){return this.append.category.length>0},broad_pattern:function(){return(0,Z.v)(this.append.word)}}),watch:{queryOptions:{handler:function(){this.fetchWords()},deep:!0}},mounted:function(){var e=this;return(0,i.Z)((0,s.Z)().mark((function t(){return(0,s.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,k.U)().ensureLoaded();case 2:return t.next=4,e.categoryStore.load();case 4:case"end":return t.stop()}}),t)})))()},methods:{fetchWords:function(){var e=this;return(0,i.Z)((0,s.Z)().mark((function t(){var r,n,o,i,c,d,u,l,p,v,h,g;return(0,s.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,e.queryOptions.hostname||(e.queryOptions.hostname=w()((0,k.U)().hosts,(function(e){return"unknown"!==e}))[0]),t.next=4,e.categoryStore.load();case 4:return r=(0,C.s3)(),n=(0,x.l8)({bid_window:"aw-watcher-window_"+e.queryOptions.hostname,bid_afk:"aw-watcher-afk_"+e.queryOptions.hostname,filter_afk:e.queryOptions.filter_afk,categories:e.categoryStore.classes_for_query,filter_categories:[e.category]})+"RETURN = limit_events(sort_by_duration(events), 1000);",t.next=8,r.query([{start:new Date(e.queryOptions.start),end:new Date(e.queryOptions.stop)}],n.split("\n"));case 8:o=t.sent,i=o[0],c=new Map,d=(0,a.Z)(i),t.prev=12,d.s();case 14:if((u=d.n()).done){t.next=37;break}l=u.value,p=l.data.title.split(/[\s\-,:()[\]/]/),v=(0,a.Z)(p),t.prev=18,v.s();case 20:if((h=v.n()).done){t.next=27;break}if(g=h.value,!(g.length<=2||e.ignored_words.includes(g))){t.next=24;break}return t.abrupt("continue",25);case 24:c.has(g)?(c.get(g).duration+=l.duration,c.get(g).events.push(l)):c.set(g,{word:g,duration:l.duration,events:[l]});case 25:t.next=20;break;case 27:t.next=32;break;case 29:t.prev=29,t.t0=t["catch"](18),v.e(t.t0);case 32:return t.prev=32,v.f(),t.finish(32);case 35:t.next=14;break;case 37:t.next=42;break;case 39:t.prev=39,t.t1=t["catch"](12),d.e(t.t1);case 42:return t.prev=42,d.f(),t.finish(42);case 45:e.words=c,e.loading=!1;case 47:case"end":return t.stop()}}),t,null,[[12,39,42,45],[18,29,32,35]])})))()},showEvents:function(e){if(this.showing_events[0]!=e){var t,r={},n=(0,a.Z)(e.events);try{for(n.s();!(t=n.n()).done;){var o=t.value,s=JSON.stringify(o.data);s in r?r[s].push(o):r[s]=[o]}}catch(g){n.e(g)}finally{n.f()}var i=[];for(var c in r){var u,l=r[c],p=(0,d.Z)((0,d.Z)({},l[0]),{},{duration:0}),v=(0,a.Z)(l);try{for(v.s();!(u=v.n()).done;){var h=u.value;p.duration+=h.duration}}catch(g){v.e(g)}finally{v.f()}i.push(p)}this.showing_events=[e,i]}else this.showing_events=[]},ignoreWord:function(e){console.log("Ignoring word: "+e),this.ignored_words.push(e)},createRule:function(e){console.log("Opening modal for creating rule with word: "+e),this.categoryStore.addClass({name:[e],rule:{type:"regex",regex:g()(e)}});var t=v()(l()(this.categoryStore.classes,"id"));this.create.word=e,this.create.categoryId=t},createRuleOk:function(){var e=this;return(0,i.Z)((0,s.Z)().mark((function t(){return(0,s.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("Creating rule with word: "+e.create.word),t.next=3,e.categoryStore.save();case 3:e.fetchWords();case 4:case"end":return t.stop()}}),t)})))()},createRuleCancel:function(){var e=this;return(0,i.Z)((0,s.Z)().mark((function t(){return(0,s.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log("Cancelling create rule"),e.create.categoryId=null,e.categoryStore.load();case 3:case"end":return t.stop()}}),t)})))()},appendRule:function(e){console.log("Opening modal to append rule with word: "+e),this.append.word=g()(e),this.$bvModal.show("appendRule")},appendRuleOk:function(){var e=this;return(0,i.Z)((0,s.Z)().mark((function t(){var r;return(0,s.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("Appending rule with word: "+e.append.word),r=e.categoryStore.get_category(e.append.category),e.categoryStore.appendClassRule(r.id,e.append.word),t.next=5,e.categoryStore.save();case 5:e.fetchWords();case 6:case"end":return t.stop()}}),t)})))()},handleOk:function(e){e.preventDefault(),this.handleSubmit(e)},handleSubmit:function(e){var t=this;this.valid?(this.$nextTick((function(){t.$bvModal.hide("appendRule")})),this.appendRuleOk()):e.preventDefault()}}},q=S;var R=r(1001),I=(0,R.Z)(q,n,o,!1,null,null,null);const z=I.exports},3522:(e,t,r)=>{var n=r(79833),o=/[\\^$.*+?()[\]{}|]/g,a=RegExp(o.source);function s(e){return e=n(e),e&&a.test(e)?e.replace(o,"\\$&"):e}e.exports=s}}]);
//# sourceMappingURL=370.b5e142a1.js.map