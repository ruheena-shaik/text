"use strict";(self["webpackChunkaw_webui"]=self["webpackChunkaw_webui"]||[]).push([[8711],{78711:(t,e,n)=>{n.r(e),n.d(e,{default:()=>_});var a=function(){var t=this,e=t._self._c;return e("div",[e("h1",[t._v("Timespiral")]),e("b-alert",{attrs:{show:"",variant:"info"}},[t._v("This is a work-in-progress experiment.")]),e("div",[t._v("Bucket: "+t._s(t.bucketId))]),e("div",[t._v("Events: "+t._s(t.events.length))]),e("Timespiral",{attrs:{events:t.events}})],1)},r=[],s=n(51055),i=n(27981),o=(n(83710),n(57658),n(85711)),u=function(){var t=this,e=t._self._c;return e("div",[e("svg",{attrs:{id:"timespiral"}})])},c=[],l=n(50257),d=n(19837),f=n(97911),h=(n(47941),n(38862),n(57327),n(41539),n(85827),n(21249),n(92222),n(65069),n(2707),n(26699),n(32023),n(89554),n(54747),n(69600),n(64958)),v=n(30381),p=n.n(v);function m(t){t=JSON.parse(JSON.stringify(t));var e=t.filter((function(t){var e=p()(t.timestamp),n=p()(t.timestamp).add(t.duration,"seconds");return!e.isSame(n,"hour")})),n=e.map((function(t){for(var e=p()(t.timestamp),n=p()(t.timestamp).add(t.duration,"seconds"),a=[(0,f.Z)((0,f.Z)({},t),{},{duration:p()(e).startOf("hour").add(1,"hour").diff(e,"seconds")}),(0,f.Z)((0,f.Z)({},t),{},{timestamp:p()(n).startOf("hour").format(),duration:p()(n).diff(n.startOf("hour"),"seconds")})],r=e.startOf("hour").add(1,"hour");r<n.startOf("hour");r.add(1,"hour")){var s=(0,f.Z)((0,f.Z)({},t),{},{timestamp:r.format(),duration:3600});a.push(s)}return a})).reduce((function(t,e){return t.concat(e)}),[]);return t.filter((function(t){return!e.includes(t)})).concat(n).sort((function(t,e){var n=p()(t.timestamp),a=p()(e.timestamp);return n.diff(a)})).reverse()}const g={name:"Timespiral",props:{events:{type:Array,default:function(){return[]}}},data:function(){return{}},computed:{split_on_hour:function(){return this.events&&this.events.length>0?m(this.events):[]}},watch:{events:function(){this.renderChart()}},mounted:function(){this.renderChart()},updated:function(){this.renderChart()},beforeUpdate:function(){var t=h.select("svg");t.selectAll("*").remove()},methods:{renderChart:function(){if(0!=this.events.length){var t,e=this.split_on_hour,n=600,a=600,r=60,s=5,i=250/s,o=20,u=i+o+20,c=h.select("svg#timespiral").style("height","".concat(n,"px")).style("width","".concat(a,"px")),f=c.append("g").attr("transform","translate(".concat(a/2,", ").concat(a/2,")")),v=h.extent(e.map((function(t){return t.timestamp}))),m=p()(v[0]).startOf("day"),g=p()(v[1]).endOf("day");t=g.clone().diff(m)/1e3>s?[g.clone().subtract(s,"days").toDate(),g.toDate()]:[m.toDate(),g.toDate()];var y=Math.ceil((t[1].valueOf()-t[0].valueOf())/864e5);e=e.filter((function(e){return p()(e.timestamp).isAfter(t[0])}));var k=h.scaleTime().domain(t).range([0,2*Math.PI*y]),w=h.scaleTime().domain(t).range([u+(a-r)/2-(i+o)*y,(a-2*r)/2]),x=h.scalePow().exponent(2).domain(t).range([i/(s-1),i]);e.forEach((function(t){t.startAngle=k(new Date(t.timestamp)),t.endAngle=k(new Date(t.timestamp).valueOf()+1e3*t.duration);var e=.05,n=p()(t.timestamp).startOf("hour");t.startAngle+=(t.startAngle-k(n))*e,t.endAngle-=(t.endAngle-k(n))*e}));var A=h.arc().innerRadius((function(t){var n=D(e[t.data].timestamp,!0),a=(0,d.Z)(n,2),r=a[0],s=a[1];return r-s/2})).outerRadius((function(t){var n=D(e[t.data].timestamp,!0),a=(0,d.Z)(n,2),r=a[0],s=a[1];return r+s/2})).cornerRadius(2);e.forEach((function(t,e){var n=h.pie().sort(null).startAngle(t.startAngle).endAngle(t.endAngle).value(p()(t.timestamp).valueOf())([e]);f.append("g").selectAll("path").data(n).join("path").attr("d",A).attr("stroke","none").attr("fill","not-afk"==t.data.status?"#0d0":"#ccc").attr("opacity",.7)}));var O="#888",b="#ccc",_=w(t[1]);E(f,0,0,"00:00",_,!0),E(f,3,0,"",_),E(f,6,0,"06:00",_,!0),E(f,9,0,"",_),E(f,12,0,"12:00",_,!0),E(f,15,0,"",_),E(f,18,0,"18:00",_,!0),E(f,21,0,"",_);var Z=p()();E(f,Z.hour(),Z.minute(),"Now",_);var M=h.timeDays.apply(h,(0,l.Z)(t));M.forEach((function(t){return I(f,t)})),T(f,4*y-1)}function D(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e?p()(t).startOf("hour").valueOf():p()(t).valueOf();return[w(n),x(n)]}function C(t,e,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=Math.cos(e),s=Math.sin(e);t.append("line").attr("x1",(n-5)*r).attr("y1",(n-5)*s).attr("x2",(n+5)*r).attr("y2",(n+5)*s).style("stroke",b).style("stroke-width",2),a&&t.append("line").attr("x1",0).attr("y1",0).attr("x2",(n-5)*r).attr("y2",(n-5)*s).style("stroke","#fff").style("stroke-width",2)}function E(t,e,n,a,r){var s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=2*Math.PI*(e/24+n/24/60)-.5*Math.PI;C(f,i,r,s);var o=Math.cos(i),u=Math.sin(i);t.append("text").text(a||p()({hours:e}).format("HH:mm")).attr("text-anchor",6==e?"start":18==e?"end":"middle").attr("dominant-baseline","middle").attr("font-size","1em").style("fill",O).attr("x",(r+10)*o).attr("y",(r+20)*u)}function I(t,e){var n=w(p()(e).add(8,"hours")),a=w(p()(e).add(14,"hours")),r=(a-n)/4,s=p()(e).startOf("day"),o="wavy".concat(e.valueOf()),u="M 2,-".concat(n," A ").concat(n+r,",").concat(n+r," 0 0 1 ").concat(a,",0");t.append("path").attr("id",o).attr("d",u).style("fill","none").style("stroke","#AAAAAA").style("stroke-width",0),t.append("text").append("textPath").text(s.format("Y-M-D")).attr("xlink:href","#".concat(o)).attr("text-anchor","left").attr("font-size","".concat(1*Math.max(x(s)/i,.5),"em")).style("fill","#555")}function T(t,e){for(var n=90,a=[],r=0;r<e*n;r++){var s=r*Math.PI/2/n,i=k.invert(s),o=D(i),u=(0,d.Z)(o,2),c=u[0],l=u[1],f=l/4;a.push((c-f)*Math.cos(s)),a.push((c-f)*Math.sin(s))}t.append("polyline").attr("points",a.join(" ")).attr("stroke","#ccc").attr("stroke-width",1).attr("fill","none")}}}},y=g;var k=n(1001),w=(0,k.Z)(y,u,c,!1,null,null,null);const x=w.exports,A={name:"TimespiralView",components:{Timespiral:x},data:function(){return{events:[],bucketId:""}},mounted:function(){var t=this;return(0,i.Z)((0,s.Z)().mark((function e(){var n,a,r;return(0,s.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=(0,o.U)(),e.next=3,n.ensureLoaded();case 3:if(a=n.bucketsAFK(n.hosts[0]),0!=a.length){e.next=7;break}return console.warn("Couldn't find suitable bucket"),e.abrupt("return");case 7:return t.bucketId=a[0],e.next=10,n.getBucketWithEvents({id:t.bucketId,start:new Date("2022-08-08")});case 10:r=e.sent,t.events=r.events,console.log("Retrieved events:",t.events),console.log("First/last event:",t.events[0],t.events[t.events.length-1]);case 14:case"end":return e.stop()}}),e)})))()},methods:{onEventClick:function(t){this.$store.commit("setSelectedEvent",t),this.$router.push({name:"EventView"})}}},O=A;var b=(0,k.Z)(O,a,r,!1,null,null,null);const _=b.exports}}]);
//# sourceMappingURL=8711.23f572bd.js.map